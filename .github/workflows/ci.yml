name: CI


on: 
  push: 
    branches: 
      - master

jobs: 
  build-and-push:
    name: 'Build and Push'
    runs-on: ubuntu-latest

  steps:
    - name: Checkout
      uses: actions/checkout@v4

  # Configuração para criar uma tag na imagem docker usando o hash do commit
  - name: Generate sha 
    id: generate_sha
    run:
      SHA=$(echo $GITHUB_SHA | head -c7)
      echo "sha=$SHA >> $GITHUB_OUTPUT"

  - name: Build docker image
    run: docker build -t api- jhonatasilva/devops_nlw:${{ steps.generate_sha.outputs.sha }} .